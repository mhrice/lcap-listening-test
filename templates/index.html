<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCAP ABX Test</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<div class="container">
    <h1 class="lead">LCAP ABX Test</h1>
    <!-- <div>{{file_x}}<br> {{file_a}}<br> {{file_b}}</div> -->
    <div class="global-buttons-container">
        <button class = "button" id="playButton">Play</button>
        <button class = "button" id="pauseButton">Pause</button>
    </div>
    <div class="audio-files-container">
        <div class="audio-buttons-container">
            <button class = "button" id="audioXButton">X</button>
            <button class = "button" id="audioAButton">A</button>
            <button class = "button" id="audioBButton">B</button>
        </div>
        <div class="slider-container">
            <div class="hp_slide">
                <div class="hp_range"></div>
            </div>
        </div>
    </div>
    <div class="submit-buttons">
        <form>
            <input type="submit" class="button" id="skip-button" value="Skip"></input>
        </form>
        <form action="/submit" method="post">
            <input type="submit" name="data" value="A is closer" class = "button" id="selectA"></input>
        </form>
        <form action="/submit" method="post">
            <input type="submit" name="data" value="B is closer" class = "button" id="selectB"></input>
        </form>

    </div>
</div>
<script>
    // for legacy browsers
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const context = new AudioContext();
    urlA = "{{file_a}}"
    urlB = "{{file_b}}"
    urlX = "{{file_x}}"

    const audioA = new Audio(urlA)
    const source1 = context.createMediaElementSource(audioA);
    source1.connect(context.destination);
    audioA.loop = true;

    const audioB = new Audio(urlB)
    const source2 = context.createMediaElementSource(audioB);
    source2.connect(context.destination);
    audioB.loop = true;

    const audioX = new Audio(urlX)
    const source3 = context.createMediaElementSource(audioX);
    source3.connect(context.destination);
    audioX.loop = true;

    audioA.muted = true;
    audioB.muted = true;

    const playButton = document.getElementById('playButton');
    const pauseButton = document.getElementById('pauseButton');
    const audioAButton = document.getElementById('audioAButton');
    const audioBButton = document.getElementById('audioBButton');
    const audioXButton = document.getElementById('audioXButton');
    const skipButton = document.getElementById('skip-button');

    const selectA = document.getElementById('selectA');
    const selectB = document.getElementById('selectB');

    audioXButton.classList.add('selected');

    playButton.addEventListener('click', function() {
        context.resume()
        audioA.play();
        audioB.play();
        audioX.play();
    });

    pauseButton.addEventListener('click', function() {
        audioA.pause();
        audioB.pause();
        audioX.pause();

    });

    audioAButton.addEventListener('click', function() {
        audioA.muted = false;
        audioB.muted = true;
        audioX.muted = true;
        audioAButton.classList.add('selected');
        audioBButton.classList.remove('selected');
        audioXButton.classList.remove('selected');

    });

    audioBButton.addEventListener('click', function() {
        audioA.muted = true;
        audioB.muted = false;
        audioX.muted = true;
        audioAButton.classList.remove('selected');
        audioBButton.classList.add('selected');
        audioXButton.classList.remove('selected');
    });

    audioXButton.addEventListener('click', function() {
        audioA.muted = true;
        audioB.muted = true;
        audioX.muted = false;
        audioAButton.classList.remove('selected');
        audioBButton.classList.remove('selected');
        audioXButton.classList.add('selected');
    });


    audioA.addEventListener('timeupdate', function() {
        var duration = audioA.duration;
        var currentTime = audioA.currentTime;
        var percentage = (currentTime / duration) * 100;
        document.querySelector('.hp_range').style.width = percentage + "%";
    });

    selectA.addEventListener('click', function() {
    });

    selectB.addEventListener('click', function() {
    });

    skipButton.addEventListener('click', function() {
        location.reload()
    });



</script>
</html>